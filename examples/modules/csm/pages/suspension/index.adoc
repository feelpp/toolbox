= Suspension Mechanics
:page-vtkjs: true
:uri-data: https://github.com/feelpp/toolbox/blob/master/examples/modules/csm/examples
:uri-data-edit: https://github.com/feelpp/toolbox/edit/master/examples/modules/csm/examples
:imagesprefix: 
ifdef::env-github,env-browser,env-vscode[:imagesprefix: ../../assets/images/]

== Introduction

We examine the displacement of the wishbones by the effect of a sinusoidal excitation.
An important part of the shock absorber is the wishbones, which is located at the wheel.
Nowadays they are manufactured in many design, but the effect of the main loads is almost the same in all. Next, we will count on a general and simple arm.

[cols="40%,60%"]
|====
a| image:{imagesprefix}suspension/image1.jpeg[width=100%] a| image:{imagesprefix}suspension/image2.jpeg[]
|====

== Running the case

The command line to run this case is

[[command-line]]
[source,sh]
----
mpirun -np 4 feelpp_toolbox_solid --case "github:{repo:toolbox,path:examples/modules/csm/examples/suspension}"
----

++++
<button class="btn" data-clipboard-target="#command-line">
Copy command line to clipboard
</button>
<button class="btn" data-clipboard-text="github:{repo:toolbox,path:examples/modules/csm/examples/suspension}">
Copy case option to clipboard
</button>
++++

NOTE: The report of the execution of the command above is available xref:suspension/solid.information.adoc[here].

=== Python interface
We start with the {feelpp} environment.

[source,python]
----
from feelpp import *
from feelpp.toolboxes.core import *
from feelpp.toolboxes.solid import *

# create the application
# create a feelppdb subdirectory where the results are stored
app = Environment(['feelpp_toolbox_solid'], opts= toolboxes_options("solid"),config=localRepository(""))
----

Next we download the study configuration and simulate it

[source,python]
----
suspensioncfg=feelpp.download("github:{repo:toolbox,path:examples/modules/csm/examples/suspension/}", worldComm=app.worldCommPtr())[0] 
suspensioncfg+='/suspension.cfg' 

if os.path.exists(suspensioncfg): 
  app.setConfigFile(suspensioncfg) 
  s = solid(dim=3)
  ok,meas=simulate(s) 
  if ok:
    # export in paraview format
    s.exportResults() 
----
== Data files

The case data files are available in Github link:{uri-data}/suspension/[here]

* link:{uri-data}/suspension/suspension.cfg[CFG file] - [link:{uri-data-edit}/suspension/suspension.cfg[Edit the file]]
* link:{uri-data}/suspension/suspension.json[JSON file] - [link:{uri-data-edit}/suspension/suspension.json[Edit the file]]

== Model/Geometry

The first step is to create the model of the object, which we can simply do in the Creo Parametric program. With this program was the fastest and easiest way to create the model.

The finished geometry (Creo) and the meshed model (Gmsh):

image:suspension/image3.png[1.png,width=604,height=294]

== Materials and boundary conditions

=== Materials

The beam is made of steel, so we need to use the following data:

* E = 200 GPa -> 200e3 N/mm^2^
* nu = 0.3
* rho = 7870 kg/m^3^ -> 7870e-9 kg/mm^3^

=== Boundary conditions


IMPORTANT: The object is fixed at the ends of the holes. The holes in the middle have the force.

image:{imagesprefix}suspension/image5.png[width=357,height=188]
image:{imagesprefix}suspension/image6.png[1.png,width=209,height=188]

== Results

NOTE: The result were run in time (two whole period, but in the pictures can be seen only a quarter period).

[source,python]
----
import pandas as pd
df=pd.DataFrame(meas)
print(df.head())

# prepare for plotting
import plotly.graph_objects as go
----

[%collapsible.result]
.Results
====
----
Paraview files are in /scratch/jupyter/feelppdb/np_1/np_1/solid.exports
   Statistics_disp_max  Statistics_disp_mean_0  Statistics_disp_mean_1  \
0             0.000000                0.000000                0.000000   
1             0.300347                0.133346                0.000059   
2             0.607255                0.271978                0.000166   
3             0.854034                0.379294                0.000305   
4             1.116512                0.499815                0.000475   

   Statistics_disp_mean_2  Statistics_disp_min  Statistics_von-mises_max  \
0                0.000000             0.000000                  0.000000   
1               -0.001735            -0.032935                208.036037   
2               -0.003278            -0.066174                419.853790   
3               -0.004200            -0.092967                594.509462   
4               -0.005155            -0.120885                775.939518   

   Statistics_von-mises_mean  Statistics_von-mises_min  time  
0                   0.000000                  0.000000   0.0  
1                  19.379505                  0.049740   0.1  
2                  39.259107                  0.104465   0.2  
3                  55.140414                  0.167094   0.3  
4                  72.230883                  0.230105   0.4  
----
====


=== Displacement

.Plot the max of the displacement over time
[source,python]
----
fig = go.Figure()
fig.add_trace(go.Scatter(x=df["time"], y=df["Statistics_disp_max"], name="max disp"))
fig.add_trace(go.Scatter(x=df["time"], y=df["Statistics_disp_min"], name="min disp"))
fig.update_layout(legend_title_text='Max displacement over time')
fig.show()
----

[%collapsible.result]
.Results
====
image:{imagesprefix}suspension/minmaxdisp.png[]
====


We display the displacement in the figures below. A 20x scale factor is used to make the displacement easy to see.
The maximum displacement is 1.778 mm. The design of the wishbones is very good because there is only little displacement due to the force.

|====
a| image:{imagesprefix}suspension/image7.png[] a| image:{imagesprefix}suspension/image8.png[] a| image:{imagesprefix}suspension/image9.png[]
a| image:{imagesprefix}suspension/image10.png[] a| image:{imagesprefix}suspension/image11.png[] | 
|====

.3D interactive model
****
Finally, we provide a 3D interactive model of the fishbone
++++

<div class="stretchy-wrapper-16_9">
<div id="vtkVisuSection1" style="margin: auto; width: 100%; height: 100%;      padding: 10px;"></div>
</div>
<script type="text/javascript">
feelppVtkJs.createSceneImporter( vtkVisuSection1, {
                                 fileURL: "https://girder.math.unistra.fr/api/v1/file/5ad4b768b0e9574027047d73/download",
                                 objects: { "deformation":[ { scene:"displacement" } ],
                                   "geometry":[ { scene:"geo",name:"solid" } ] }
                               } );
</script>

++++
****

=== Von-Mises Criterions

.Plot the max of the von-mises criterion over time
[source,python]
----
fig = go.Figure()
fig.add_trace(go.Scatter(x=df["time"], y=df["Statistics_von-mises_max"],name="max")) 
fig.add_trace(go.Scatter(x=df["time"], y=df["Statistics_von-mises_min"],name="min"))
fig.add_trace(go.Scatter(x=df["time"], y=df["Statistics_von-mises_mean"],name="mean"))
fig.update_layout(legend_title_text='Von-Mises min,mean and max over time')
fig.show()
----

[%collapsible.result]
.Results
====
image:{imagesprefix}suspension/minmaxvonmises.png[]
====