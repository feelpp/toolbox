= Sensor
:experimental:
:page-vtkjs: true
:uri-data: https://github.com/feelpp/toolbox/blob/master/examples/modules/csm/examples
:uri-data-edit: https://github.com/feelpp/toolbox/edit/master/examples/modules/csm/examples
:imagesprefix: 
ifdef::env-github,env-browser,env-vscode,backend-jupyter[:imagesprefix: ../../assets/images/]
:page-jupyter: ../../attachments/sensor/index.ipynb
:jupyter-language-name: python
:jupyter-language-version: 3.8
:url-ipywidgets: https://ipywidgets.readthedocs.io/en/stable/

xref:attachment$sensor/index.ipynb[[> Download this page as notebook\]]

== Introduction

Presentation of the basic for force measurement with strain gauges.

A *strain gauge* is a device used to measure strain on an object. The most common type of strain gauge consists of an insulating flexible backing which supports a metallic foil pattern. The gauge is attached to the object by a suitable adhesive. As the object is deformed, the foil is deformed, causing its electrical resistance to change. This resistance change, usually measured using a Wheatstone bridge, is related to the strain by the quantity known as the _gauge factor_.

[.grid]
CAD representation of a strain gauge:: 
  image:{imagesprefix}sensor/image1.png[width=200,height=200]
Representation of a strain gauge::
  image:{imagesprefix}sensor/image2.png[width=200,height=200]
Strain gauge::
  image:{imagesprefix}sensor/image3.png[width=200,height=200]


== Running the case

===  Command line

The command line to run this case is

[[command-line]]
[source,sh]
----
!mpirun -np 4 feelpp_toolbox_solid --case "github:{repo:toolbox,path:examples/modules/csm/examples/sensor}"
----

++++
<button class="btn" data-clipboard-target="#command-line">
Copy command line to clipboard
</button>
<button class="btn" data-clipboard-text="github:{repo:toolbox,path:examples/modules/csm/examples/sensor}">
Copy case option to clipboard
</button>
++++

NOTE: The report of the execution of the command above is available xref:sensor/solid.information.adoc[here].


=== Python interface

[source,python]
----
from feelpp import *
from feelpp.toolboxes.core import *
from feelpp.toolboxes.solid import *

# create the application
# create a feelppdb subdirectory where the results are stored
app = Environment(['feelpp_toolbox_solid'], opts= toolboxes_options("solid"),config=localRepository("")) 
app.setConfigFile("../../examples/sensor/capteur.cfg")
s = solid(dim=3)
# get displacement and von-mises measures from the model
ok,meas=simulate(s)
if ok:
  # export in paraview format
  s.exportResults()
----

== Data files

The case data files are available in Github link:{uri-data}/sensor/[here]

* link:{uri-data}/sensor/capteur.cfg[CFG file] - [link:{uri-data-edit}/sensor/capteur.cfg[Edit the file]]
* link:{uri-data}/sensor/capteur.json[JSON file] - [link:{uri-data-edit}/sensor/capteur.json[Edit the file]]

== Model/Geometry

The first step is to create the model of the object, which we can simply do in the Creo Parametric program. With this program was the fastest and easiest way to create the model.

The finished geometry (Creo) and the meshed model (Gmsh):

[.grid]
CAD representation of a strain gauge::
  image:{imagesprefix}sensor/image4.png[thumb,width=302,height=268]
Mesh representation of a strain gauge::
  image:{imagesprefix}sensor/image5.png[thumb,width=302,height=279]

== Materials and boundary conditions

=== Materials

The beam is made of steel, so we need to use the following data:

* latexmath:[E = 205 GPa -> 205e3 N/mm^2]
* latexmath:[nu = 0.3]
* latexmath:[rho = 7850 kg/m^3 -> 7850e-9 kg/mm^3]

=== Boundary conditions

The object is fixed in the middle. Holes have opposite sinusodal forces.

[.grid]
CAD representation of a strain gauge::
  image:{imagesprefix}sensor/image6.png[thumb,width=306,height=283]
Mesh representation of a strain gauge::
  image:{imagesprefix}sensor/image7.png[thumb,width=287,height=283]


== Results

IMPORTANT: The result were run in time (half whole period, but on the pictures can be seen only a quarter period).

[source,python]
----
import pandas as pd
df=pd.DataFrame(meas)
print(df.head())

# prepare for plotting
import plotly.graph_objects as go
----

=== Displacement

[.grid]
displacement at latexmath:[t=0.1s]::
  image:{imagesprefix}sensor/image8.png[]
displacement at latexmath:[t=0.2s]::  
  image:{imagesprefix}sensor/image9.png[] 
displacement at latexmath:[t=0.3s]::  
  image:{imagesprefix}sensor/image10.png[]
displacement at latexmath:[t=0.4s]::   
  image:{imagesprefix}sensor/image11.png[] 
displacement at latexmath:[t=0.5s]::   
  image:{imagesprefix}sensor/image12.png[]


.Plot the max of the displacement over time
[source,python]
----
fig = go.Figure()
fig.add_trace(go.Scatter(x=df["time"], y=df["Statistics_disp_max"], name="max disp"))
fig.add_trace(go.Scatter(x=df["time"], y=df["Statistics_disp_min"], name="min disp"))
fig.update_layout(legend_title_text='Max displacement over time')
fig.show()
----

=== Von-Mises Criterions

[.grid]
Von-Mises criterion at latexmath:[t=0.1s]::
  image:{imagesprefix}sensor/image13.png[image] 
Von-Mises criterion  at latexmath:[t=0.2s]::  
  image:{imagesprefix}sensor/image14.png[image] 
Von-Mises criterion  at latexmath:[t=0.3s]::
  image:{imagesprefix}sensor/image15.png[image]
Von-Mises criterion  at latexmath:[t=0.4s]::
  image:{imagesprefix}sensor/image16.png[image] 
Von-Mises criterion  at latexmath:[t=0.5s]::
  image:{imagesprefix}sensor/image17.png[image] 


On the displacement and stress diagrams, it can be clearly seen that this object is perfectly suited as a sensor.

.Plot the max of the von-mises criterion over time
[source,python]
----
fig = go.Figure()
fig.add_trace(go.Scatter(x=df["time"], y=df["Statistics_von-mises_max"],name="max")) 
fig.add_trace(go.Scatter(x=df["time"], y=df["Statistics_von-mises_min"],name="min"))
fig.add_trace(go.Scatter(x=df["time"], y=df["Statistics_von-mises_mean"],name="mean"))
fig.update_layout(legend_title_text='Von-Mises min,mean and max over time')
fig.show()
----

=== 3D Model

NOTE: this section is available only in html, it is not supported in jupyter notebooks. It displays the 3D model of the object.

++++

<div class="stretchy-wrapper-16_9">
<div id="vtkVisuSection1" style="margin: auto; width: 100%; height: 100%;      padding: 10px;"></div>
</div>
<script type="text/javascript">
feelppVtkJs.createSceneImporter( vtkVisuSection1, {
                                 fileURL: "https://girder.math.unistra.fr/api/v1/file/5ad4bff6b0e9574027047d77/download",
                                 objects: { "deformation":[ { scene:"displacement" }, { scene:"von_mises" }, { scene:"pid" } ] }
                               } );
</script>

++++

